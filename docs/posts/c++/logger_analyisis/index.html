<!DOCTYPE html>
<html>
  <head>
    <title>日志系统性能分析与优化</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/css/plyr.css"/>
<link rel="stylesheet" href="/css/flag-icon.min.css"/>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />




  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/site/logo_inverted_hua3efbebda7e0f6b36d7702fa91bfea5d_215975_42x0_resize_box_3.png" />

<meta property="og:title" content="日志系统性能分析与优化" />
<meta property="og:description" content="日志系统在任何稍微有点规模的软件系统中都是必不可少的组成部分，它是我们分析代码和解决问题的有效手段和得力助手。一份详尽而精准的日志能让我们解决问题事半功倍。很多时候由于日志的频繁打印很容易造成日志系统本身成为性能热点，下面让我们详细分析下作为日志系统的调用方需要注意的一些问题。
日志打印 大多数的日志系统都会提供print和stream两种调用方式。简单的如：
logger::get().info(&#34;%s&#34;, &#34;log message&#34;); logger::get().info() &lt;&lt; &#34;log message&#34; &lt;&lt; std::endl; 使用日志等级进行输出优化 除此之外，日志系统一般还会提供日志分级功能，通过日志分级我们可以在程序运行时动态控制日志输出，减少不必要的日志打印。日志分级可以通过如下伪代码试下：
class Logger { public: void trace(const std::string_view&amp; fmt, ...) { if (log_level_ &lt; 0) // 通过日志等级，判断是否需要真正打印 return; printf(...); } void debug(const std::string_view&amp; fmt, ...) { if (log_level_ &lt; 1) return; printf(...); } void info(const std::string_view&amp; fmt, ...) { if (log_level_ &lt; 2) return; printf(...); } void set_level(int level) { log_level_ = level; } ... private: int log_level_ = 0; }; 通过上面的代码我们可以看到如果调用set_level(2) 那么下面三条日志只打印一条日志结果：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gqw.gitee.io/posts/c&#43;&#43;/logger_analyisis/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-01-18T00:00:00+00:00" />


    
    
<meta name="description" content="日志系统性能分析与优化" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">

<link rel="stylesheet" href="/css/style.css"/>




  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  


  




  
  
    
  
  



  
  
    
  
  


<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      
        <img src="/images/author/gqw_hu5efc0d87f8f199adb207d1cb2c6bb877_469741_42x0_resize_box_3.png" alt="Logo">
      顾起威的博客</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  
    <img src="/images/author/gqw_hu5efc0d87f8f199adb207d1cb2c6bb877_469741_42x0_resize_box_3.png" class="d-none" id="main-logo" alt="Logo">
  
  
    <img src="/images/author/gqw_hu5efc0d87f8f199adb207d1cb2c6bb877_469741_42x0_resize_box_3.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">博文</a></li>
            <div class="subtree">
                
  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/c&#43;&#43;/">C&#43;&#43;</a>
      
      <ul class="active">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/c&#43;&#43;/coroutine/" title="深入浅出C&#43;&#43; 20 Coroutine TS">深入浅出C&#43;&#43; 20 Coroutine TS</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/c&#43;&#43;/coro_redis/" title="coro_redis 开发手记">coro_redis 开发手记</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/c&#43;&#43;/serialization/" title="C&#43;&#43;序列化和反序列化工具">C&#43;&#43;序列化和反序列化工具</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/c&#43;&#43;/build_gcc/" title="Linux 编译GCC 11">Linux 编译GCC 11</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/c&#43;&#43;/logger_analyisis/" title="日志系统性能分析与优化">日志系统性能分析与优化</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/git/">Git</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/git/sync_github_gitee/" title="同步GitHub pages和 Gitee pages方法">同步GitHub pages和 Gitee pages方法</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/">强化学习</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/001_simple_env/" title="创建最简单的gym自定义环境">创建最简单的gym自定义环境</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/linux_remote_gui_use_vcxsvr/" title="在Windows中运行远程Linux图形程序">在Windows中运行远程Linux图形程序</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/test/" title="测试">测试</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/net/">网络</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/net/tcptrace/" title="Windows下基于tcp协议的traceroute实现">Windows下基于tcp协议的traceroute实现</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/net/p2p/" title="一种简单可行的P2SP实践方案">一种简单可行的P2SP实践方案</a></li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://gqw.gitee.io/posts/c&#43;&#43;/logger_analyisis/log_system.png);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/gqw_hu5efc0d87f8f199adb207d1cb2c6bb877_469741_120x120_fit_box_3.png' alt="Author Image">
          <h5 class="author-name">阿修罗</h5>
          <p>January 18, 2023 | 600 Words | Read in about 3 Min | 本文总阅读量<span id="busuanzi_value_page_pv"></span>次</p>
		  <h6 id="wc"></h6>
        </div>
        <div class="title">
          <h1>日志系统性能分析与优化</h1>
        </div>

        <div class="post-content" id="post-content">
          <p>日志系统在任何稍微有点规模的软件系统中都是必不可少的组成部分，它是我们分析代码和解决问题的有效手段和得力助手。一份详尽而精准的日志能让我们解决问题事半功倍。很多时候由于日志的频繁打印很容易造成日志系统本身成为性能热点，下面让我们详细分析下作为日志系统的调用方需要注意的一些问题。</p>
<h2 id="日志打印">日志打印</h2>
<p>大多数的日志系统都会提供<code>print</code>和<code>stream</code>两种调用方式。简单的如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>logger<span style="color:#f92672">::</span>get().info(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;log message&#34;</span>);
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">::</span>get().info() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;log message&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span></code></pre></div><h2 id="使用日志等级进行输出优化">使用日志等级进行输出优化</h2>
<p>除此之外，日志系统一般还会提供日志分级功能，通过日志分级我们可以在程序运行时动态控制日志输出，减少不必要的日志打印。日志分级可以通过如下伪代码试下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Logger</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> trace(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string_view<span style="color:#f92672">&amp;</span> fmt, ...) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (log_level_ <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>)   <span style="color:#75715e">// 通过日志等级，判断是否需要真正打印
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        printf(...);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">debug</span>(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string_view<span style="color:#f92672">&amp;</span> fmt, ...) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (log_level_ <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        printf(...);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">info</span>(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string_view<span style="color:#f92672">&amp;</span> fmt, ...) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (log_level_ <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        printf(...);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_level</span>(<span style="color:#66d9ef">int</span> level) {
</span></span><span style="display:flex;"><span>      log_level_ <span style="color:#f92672">=</span> level;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> log_level_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>通过上面的代码我们可以看到如果调用<code>set_level(2)</code> 那么下面三条日志只打印一条日志结果：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>  logger<span style="color:#f92672">::</span>get().set_level(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>  logger<span style="color:#f92672">::</span>get().trace(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;hello, I&#39;m trace log&#34;</span>);
</span></span><span style="display:flex;"><span>  logger<span style="color:#f92672">::</span>get().debug(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;hello, I&#39;m debug log&#34;</span>);
</span></span><span style="display:flex;"><span>  logger<span style="color:#f92672">::</span>get().info(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;hello, I&#39;m info log&#34;</span>);
</span></span></code></pre></div><pre tabindex="0"><code>hello, I&#39;m info log
</code></pre><p><code>trace</code> 和 <code>debug</code> 日志被 <code>log_level_</code> 开关优化过滤掉了。在实际的工程实践中我们除了<code>trace</code>、<code>debug</code>、<code>info</code> 日志级别外通常还有 <code>warnning</code>、<code>error</code>、<code>fatal</code>等级别。</p>
<pre tabindex="0"><code>trace:  尽可能详细的日志，甚至代码的每个逻辑分支都可以打印一条，trace日志能够帮助了解系统的运行流程
debug： 用于帮助调试的日志
info：  少量但关键信息的日志，一般用于打印系统的关键状态
warn：  警告日志，代表系统逻辑有异常，但是不影响系统的正常运作。警告日志不代表可以放任不管，出现警告日志一般代表了超出了预期的逻辑存在，虽然现在能够运行，但不代表以后不会出现致命问题，出现警告日志最好能仔细排查原因，如果确定没有问题，可以去掉此日志
error： 代表了出现了明确的错误逻辑，需要认真对待，仔细排查
fatal： 代表出现了致命错误，如果出现此日志信息意味着程序应该立即准备善后工作，退出进程
</code></pre><p>工程如果处于开发调试阶段一般会将日志级别定在<code>info</code>级别或以下(即打开<code>debug</code>或<code>trace</code>)，但线上运行时会将日志级别调到<code>info</code>级别或以上，最起码需要保证<code>error</code>和<code>fatal</code>的输出。建议设为<code>info</code>级别，因为<code>info</code>日志本身就比较少，不会成为性能瓶颈，而<code>warn</code>日志可以帮助我们发现和优化潜在的问题。</p>
<h2 id="使用宏进一步优化日志">使用宏进一步优化日志</h2>
<p>虽然通过日志级别减少了日志输出，但是却没有减少日志调用。什么意思呢？我们下面几个例子的反汇编代码来直观的了解下原理。</p>
<p>首先让我们创建一个空的工程，这里面只有一个<code>main</code>函数，然后我们通过一步步添加代码来观察比较反汇编代码的变化。</p>
<iframe width="800px" height="100%" src="https://godbolt.org/e?readOnly=true&hideEditorToolbars=true#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,selection:(endColumn:14,endLineNumber:2,positionColumn:14,positionLineNumber:2,selectionStartColumn:14,selectionStartLineNumber:2,startColumn:14,startLineNumber:2),source:'int+main()+%7B%0A++++return+0%3B%0A%7D'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:54.647465798216416,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:g94,deviceViewOpen:'1',filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,libs:!(),options:'-std%3Dc%2B%2B17+-O0',selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:1),l:'5',n:'0',o:'+x86-64+gcc+9.4+(Editor+%231)',t:'0')),k:45.352534201783605,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>
<p>现在让我们添加个简单的日志系统：</p>
<iframe width="800px" height="700px" src="https://godbolt.org/e?readOnly=true&hideEditorToolbars=true#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYTStJg1DIApACYAQuYukl9ZATwDKjdAGFUtAK4sGEgBykrgAyeAyYAHI%2BAEaYxCAArACcpAAOqAqETgwe3r4BaRlZAqHhUSyx8cm2mPaOAkIETMQEuT5%2BXIF2mA7Zjc0EpZExcYkpCk0tbfmdtpODYcMVo8kAlLaoXsTI7BzmAMxhyN5YANQm%2B24T%2BKgAdAgX2CYaAIIHRyeY55fXzcD3j2eb1exyYCgUp2CqGAwDip3OAHYrK9Ul5orQ8MgQED4fCJkxHMhTgA3VB4dCnAjEJg7CBoBgTU7IBDNABUpyoLAIpCZAkZzLZpxYCmAq0RyJeuKlpzwVFOEFo0IA%2BvRibUld83KcNGL4QB6PXnbBJEz%2BDQmJJvbD%2BEwWABipoRJmwADYLU6XglnV77e7nR6ACKmk3YJ0WN4vJ3YB0WNymuPYL3%2BG0vSTOt1JN0vIOui0ph2Ji3ml5u40WuNm50pt3%2BLj%2B8sWgtZoMvfbp4MWtuF/xBizm17SwenYiYAhbBgXCU4oepYhhAhUahcnnC0WT6fwkwIoOvDenfGEklkilYaJeYB0vkEJks4jsznc3kM68Cu9CkVircSocyuUK5WquqmqnFwqx7j%2BI5jsQE77FOA4znOgiLg%2BK4fuu8GbtuQJ7gemJHuSMoMPwl7PjegooU%2B/K3uyq6fki4G4rK8qKsAKqYGqtAahcWpmGBGE/sOo7juhwKSgh87Icu75rrBe5bjuolSrhRKkgRADuzQMCRVHkVJ9I6W%2BtHigx8JMf%2BrGAZxwH7HxYkCYJUEwXBdnSrOElLo%2BtEiVK8nYfxyn4RScTECQ2kvtRHJ6VeZGGR%2Bxn8VKZksWxHFcZcpySLZ9nwpBwmybuCW4m5SEeahMnfrivkFS5AWqRSVAEmIYUxfeUWka%2BNFxV%2BJm/sxAHsUB3GnAkWXZbl0EiT1xULqV0lgflLlVYpuK1ce%2B6jiltQQPOpyWXRFVSslllpQGu0DbQ3mVVh1VucSBLsDhTSHjtR3nUqk1YQtQI7SwTBhBA%2B17lCMKjCASgEJttAQLxl3wsDsLxCAVI0pgEDmGY5gJAo6M8ujyM7Lt0Lo/NB2QtCCMgCAp7nmjZgY2YWM4%2BcdPU8AhPAMTsNkyDiNhMR6OY9jdO43TfOoOznMLVK40MNqH0Bhw6y0JwCS8H4HBaKQqCcHGljWPumzbF8Bw8KQBCaIr6wANaJJItwupICKSC6CQIkk/hmFwDte/onCSGrFta5wvAKCAGhmxb6xwLASBoCwqR0HE5CUHHCf0PEwBJNIWDEpimAAGp4JgakAPKpIwnCmzQtAEHEocQNEgfRGEzQAJ6V7wzfMMQrcl9E2g9Ob3C8HHbCCCXDC0O3Gu8Fgv1GOIM%2BkPgI69GqodL5gqg9F4tcd%2BQgi1IHGLRNSPceFggdUngLAd%2BsVAGMACiF8XZcV8PMiCCIYjsFIn/yEoNQgddBcH0IYYw1hrD6DwNEUOkB1ioFSPUBknAAC01wLgBlMHrSwXAESnFQSXTW3RejOAgK4aYHQggMHQEMcolQ9DpEyMgyhjCijILoSMeIoCSHIP6FMTw7Q9C8L6PMThyxuFzAGKwnhYjFj0NGKBDYWwdgSCVirAOS9tYcFOKofwLpUEO1OMAZARIki3EkPKXAhASDM32KBXgQ8tCrGtiASQCRbj7ASAzfYkgzAaDwf4fYLoNAJF9hwf2pB1aa20SHMOEcZ4uPCWYTRMTg4JOcesNUxBMjOEkEAA%3D"></iframe>
<p>先让我们看下右边<code>main</code>函数的反汇编代码86~94行代码，我们可以看到虽然我们只打印了：</p>
<pre tabindex="0"><code>info log
</code></pre><p>一行日志， 但是在88行和91行我们还是看到了<code>trace</code>和<code>debug</code>的代码调用，在<code>trace</code>和<code>debug</code>的函数内部条件判断的指令还是会被执行。在上面的代码中我们已经尽量地简化，对于一个复杂的日志系统会产生更多的调用指令，如果我们的<code>trace</code>和<code>debug</code>的日志非常多，这必然会造成巨大的性能浪费。</p>
<p>在C++中我们为了避免这样的性能开销一般会使用宏来控制无效指令的生成, 例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define LOG_LEVEL_TRACE    0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LOG_LEVEL_DEBUG    1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LOG_LEVEL_INFO     2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LOG_LEVEL_WARN     3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LOG_LEVEL_ERROR    4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LOG_LEVEL_FATAL    5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LOG_LEVEL_CLOSE    6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    Logger<span style="color:#f92672">::</span>set_level(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if LOGGER_LEVEL &lt;= LOG_LEVEL_TRACE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Logger<span style="color:#f92672">::</span>trace(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;trace log&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#if LOGGER_LEVEL &lt;= LOG_LEVEL_DEBUG
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Logger<span style="color:#f92672">::</span>debug(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;debug log&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#if LOGGER_LEVEL &lt;= LOG_LEVEL_INFO
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Logger<span style="color:#f92672">::</span>info(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;info log&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>对应的汇编指令如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>main:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">Logger</span>::<span style="color:#66d9ef">set_level</span>(<span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">esi</span>, <span style="color:#66d9ef">OFFSET</span> <span style="color:#66d9ef">FLAT</span>:.<span style="color:#66d9ef">LC0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">edi</span>, <span style="color:#66d9ef">OFFSET</span> <span style="color:#66d9ef">FLAT</span>:.<span style="color:#66d9ef">LC1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">Logger</span>::<span style="color:#66d9ef">info</span>(<span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span>*, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span>*)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pop</span>     <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ret</span>
</span></span></code></pre></div><p>可以看到已经没有<code>trace</code>和<code>debug</code>的调用指令了， 但在每个调用的地方都这样用宏包裹下实在是太麻烦，更一般的做法是像下面这样将日志调用做成宏的样子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#if (LOGGER_LEVEL &gt; -1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 LOG_TRACE(fmt, ...) Logger::trace(&#34;TRACE &#34;##fmt, #__VA_ARGS__)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 LOG_TRACE(fmt, ...)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if (LOGGER_LEVEL &gt; 0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 LOG_DEBUG(fmt, ...) Logger::debug(&#34;DEBUG &#34;##fmt, #__VA_ARGS__)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 LOG_DEBUG(fmt, ...)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if (LOGGER_LEVEL &gt; 1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 LOG_INFO(fmt, ...) Logger::info(&#34;INFO &#34;##fmt, #__VA_ARGS__)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 LOG_INFO(fmt, ...)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> main() {
</span></span><span style="display:flex;"><span>    Logger<span style="color:#f92672">::</span>set_level(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    LOG_TRACE(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;trace log&#34;</span>);
</span></span><span style="display:flex;"><span>    LOG_DEBUG(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;debug log&#34;</span>);
</span></span><span style="display:flex;"><span>    LOG_INFO(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#e6db74">&#34;info log&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="应不应该使用流式日志输出">应不应该使用流式日志输出</h2>
<p>大多数的日志系统除了提供<code>print</code>日志输出方式，一般还会提供流式输出方式，例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Logger<span style="color:#f92672">::</span>get().trace() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;stream trace: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>Logger<span style="color:#f92672">::</span>get().debug() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;stream debug: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>Logger<span style="color:#f92672">::</span>get().info() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;stream info: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100</span>;
</span></span></code></pre></div><p>这种方式，极大的方便了日志使用者，但也造成了性能的退化。为什么这么说呢？让我们来看个简单的例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; stream log&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; test&#34;</span>;
</span></span></code></pre></div><p>我们看下反汇编代码(为了方便观察去掉了模板参数信息)：</p>
<pre tabindex="0"><code>    mov     esi, OFFSET FLAT:.LC0
    mov     edi, OFFSET FLAT:_ZSt4cout
    call    std::basic_ostream&lt;&gt;&amp; std::operator&lt;&lt; (std::basic_ostream&lt;&gt;&amp;, char const*)
    mov     esi, 100
    mov     rdi, rax
    call    std::basic_ostream&lt;&gt;::operator&lt;&lt;(int)
    mov     esi, OFFSET FLAT:.LC1
    mov     rdi, rax
    call    std::basic_ostream&lt;&gt;&amp; std::operator&lt;&lt; (std::basic_ostream&lt;&gt;&amp;, char const*)
</code></pre><p>从上面的汇编代码中我们可以看到每一个<code>&lt;&lt;</code>操作符就是一次函数调用（call 指令）。我们无法实现像前面介绍的<code>LOG_XXXX</code>方式定义宏来在编译期优化掉无效的日志调用。</p>
<p>那是否就束手无策了呢？其实我们还是有一些技巧来优化这种开销的，首先我们需要定义一个支持流操作的日志类:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoggerOfNone</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	LoggerOfNone() <span style="color:#f92672">=</span> <span style="color:#66d9ef">default</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	LoggerOfNone<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(T content) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>可以看到<code>operator&lt;&lt;</code>操作符函数没有做任何事，相当于是一个空调用，然后我们进行如下调用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    LoggerOfNone() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; stream log&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; test&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们设置<code>g++</code>优化选项为<code>-O0</code>,即不做任何优化，得到反汇编代码：</p>
<pre tabindex="0"><code>main:
        push    rbp
        mov     rbp, rsp
        sub     rsp, 16
        lea     rax, [rbp-1]
        mov     esi, OFFSET FLAT:.LC0
        mov     rdi, rax
        call    LoggerOfNone&amp; LoggerOfNone::operator&lt;&lt; &lt;char const*&gt;(char const*)
        mov     esi, 100
        mov     rdi, rax
        call    LoggerOfNone&amp; LoggerOfNone::operator&lt;&lt; &lt;int&gt;(int)
        mov     esi, OFFSET FLAT:.LC1
        mov     rdi, rax
        call    LoggerOfNone&amp; LoggerOfNone::operator&lt;&lt; &lt;char const*&gt;(char const*)
        mov     eax, 0
        leave
        ret
</code></pre><p>可以看到仍然是三次<code>operator&lt;&lt;</code>函数调用， 但是不用泄气，我们现在将优化选项设为<code>-O3</code>，我们再试一次得到：</p>
<iframe width="800px" height="400px" src="https://godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:'%0Aclass+LoggerOfNone+%7B%0Apublic:%0A%09LoggerOfNone()+%3D+default%3B%0A%0A++++template%3Ctypename+T%3E%0A%09LoggerOfNone%26+operator%3C%3C(T+content)+%7B%0A%09%09return+*this%3B%0A%09%7D%0A%7D%3B%0A%0Aint+main()+%7B%0A++++LoggerOfNone()+%3C%3C+%22+stream+log%22+%3C%3C+100+%3C%3C+%22+test%22%3B%0A++++return+0%3B%0A%7D'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:35.920770877944335,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:g94,deviceViewOpen:'1',filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,libs:!(),options:'-std%3Dc%2B%2B17+-O3+-DLOGGER_LEVEL%3D2',selection:(endColumn:12,endLineNumber:3,positionColumn:12,positionLineNumber:3,selectionStartColumn:12,selectionStartLineNumber:3,startColumn:12,startLineNumber:3),source:1),l:'5',n:'0',o:'+x86-64+gcc+9.4+(Editor+%231)',t:'0')),k:64.0792291220557,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>
<p>神奇的事情发生了，我们得到了非常干净的结果，没有任何多余的调用发生。这是因为我们调用一个空函数时编译器会自动优化掉。所以我们可以根据这个特性可以做如下优化：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LoggerOfNone g_logger_none;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if (LOGGER_LEVEL &gt; -1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 LOG_TRACE(fmt, ...) Logger::trace(&#34;TRACE &#34;##fmt, #__VA_ARGS__)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 STREAM_TRACE() std::cout
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 LOG_TRACE(fmt, ...)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	define	 STREAM_TRACE() g_logger_none
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>可以看到当不满足日志等级时，我们边返回<code>LoggerOfNone</code>空日志对象。这样起码能保证在有编译器优化的情况下能得到较好的结果。</p>
<p>但是是不是这样就能高枕无忧了呢？很不幸，并不能！！！ 让我们看下下面的例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string GetTestStr() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;tt&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;hello&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    STREAM_TRACE() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; stream log&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">&lt;&lt;</span> GetTestStr();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>优化选项仍然设为<code>-O3</code>，得到：</p>
<pre tabindex="0"><code>main:
        sub     rsp, 40
        mov     rdi, rsp
        call    GetTestStr[abi:cxx11]()
        mov     rdi, QWORD PTR [rsp]
        lea     rax, [rsp+16]
        cmp     rdi, rax
        je      .L12
        call    operator delete(void*)
.L12:
        xor     eax, eax
        add     rsp, 40
        ret
</code></pre><p>我们看到虽然<code>operator&lt;&lt;</code>操作符函数调用被优化了， 但是<code>GetTestStr()</code>却被调用了，实际上我们并不想它被调用。</p>
<p>所以从性能上考虑<code>stream</code>与<code>print</code>方式相比， 我这里更推荐使用<code>print</code>方式输出。</p>
<h2 id="另一种选择">另一种选择</h2>
<p>从前面分析我们可以得到<code>print</code>日志输出方式能得到更好的性能的结论，但是<code>print</code>格式化打印对于使用者来说实在是太不友好了，可以说相当难用。但是对于Mordern C++来说我们有了另一种选择，那就是<a href="https://en.cppreference.com/w/cpp/utility/format/format"><code>std::format</code></a>(需要C++ 20支持)也可以使用<a href="https://fmt.dev/latest/index.html"><code>fmt</code></a>（只需要C++ 11）。</p>
<p>最后推荐<a href="https://github.com/gabime/spdlog"><code>spdlog</code></a>能够完美支持前面所说的三种调用方式。通过简单的封装可以实现如下效果：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>     logger<span style="color:#f92672">::</span>get().set_level(spdlog<span style="color:#f92672">::</span>level<span style="color:#f92672">::</span>info);
</span></span><span style="display:flex;"><span>     STM_DEBUG() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;STM_DEBUG &#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>     PRINT_WARN(<span style="color:#e6db74">&#34;PRINT_WARN, %d&#34;</span>, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>     LOG_INFO(<span style="color:#e6db74">&#34;LOG_INFO {}&#34;</span>, <span style="color:#ae81ff">2</span>);
</span></span></code></pre></div><p>详细代码可以参考<a href="https://github.com/gqw/spdlog_wrapper"><code>spdlog_wrapper</code></a></p>
<div id="utter-container"></div>
			<script src="https://utteranc.es/client.js"
				repo= 'gqw/hugocomment'
				issue-term= "title"
				theme= 'github-light'
				crossorigin= "anonymous"
				async>
			</script>
        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/gqw/gqw.github.io/edit/source/content/posts/C&#43;&#43;/logger_analyisis/index.md" title="改善此页面" target="_blank" rel="noopener">
                <i class="fas fa-code-branch"></i>
                改善此页面
              </a>
          </div>
        

        
      <hr />
        







  





  
  

  
  

  
  

  
  

  
    
    
  
  

  
  

  
  

  
  

  
  

  
  

  
  


<div class="row next-prev-navigator">
  
    <div class="col-md-6 previous-article">
      <a href="/posts/c&#43;&#43;/build_gcc/" title="Linux 编译GCC 11" class="btn btn-outline-info">
        <div><i class="fas fa-chevron-circle-left"></i> 上一篇</div>
        <div class="next-prev-text">Linux 编译GCC 11</div>
      </a>
    </div>
  
  
      
      
        
      
      <div class="col-md-6 next-article">
        <a href="/posts/git/sync_github_gitee/" title="同步GitHub pages和 Gitee pages方法" class="btn btn-outline-info">
          <div>下一篇 <i class="fas fa-chevron-circle-right"></i></div>
          <div class="next-prev-text">同步GitHub pages和 Gitee pages方法</div>
        </a>
      </div>
    
</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">目录</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#日志打印">日志打印</a></li>
    <li><a href="#使用日志等级进行输出优化">使用日志等级进行输出优化</a></li>
    <li><a href="#使用宏进一步优化日志">使用宏进一步优化日志</a></li>
    <li><a href="#应不应该使用流式日志输出">应不应该使用流式日志输出</a></li>
    <li><a href="#另一种选择">另一种选择</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    











  
  
    
  

  
  
    
  

  
  
    
    
      
    
  


  
  
  
    
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-4 col-sm-12">
          <h5>导航</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#recent-posts">最近发表</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#about">关于</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#experiences">工作经历</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#skills">技能</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#education">教育经历</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#projects">开源项目</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#achievements">成就</a>
                </li>
              
          </ul>
          
        </div>
        
        
        <div class="col-md-4 col-sm-12">
          <h5>联系方式:</h5>
          <ul>
            
            <li><span>Email: </span> <span>gqwmail@qq.com</span></li>
            
          </ul>

		  <h5>友情链接: </h5>
		  <ul>
			<li><a href="http://purecpp.org/" itemprop="url" rel="index"><span itemprop="name">Pure C++</span></a></li>
			<li><a href="https://kinly.github.io/" itemprop="url" rel="index"><span itemprop="name">蒋磊的博客</span></a></li>
		  </ul>

        </div>
        
		<div class="col-md-4 col-sm-12">
			<span id="busuanzi_container_site_pv">
            本站访问量：<span id="busuanzi_value_site_pv"></span>次
			</span>
			</br>
			<span id="busuanzi_container_site_uv">
				您是本站第 <span id="busuanzi_value_site_uv"></span> 位访问者
			</span>

			<div>
				<a href="https://clustrmaps.com/site/1bj40"  title="Visit tracker"><img alt="gqw.github.io" src="//www.clustrmaps.com/map_v2.png?d=P-jZSVLaaxENhQ3Na5ckx6td6DpcUROVmi1mIeNEQTA&cl=ffffff" /></a>
			</div>
		</div>
        
        
      </div>
    </div>
    
    
    <hr />
    <div class="container">
      <div class="row text-left">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hossainemruz/toha" target="_blank" rel="noopener">
            <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">© 2020 Copyright.</div>
        <div class="col-md-4 text-right">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">Powered by
          <img
            src="/images/hugo-logo.svg"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    
  </footer>
  <script
	  src="https://code.jquery.com/jquery-3.5.1.min.js"
	  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
	  crossorigin="anonymous"></script>
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/plyr.js"></script>
<script type="text/javascript" src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
